@model AracKiralamaPortal.Models.Car
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<link href="~/css/car.css" rel="stylesheet" />

<div class="container mt-5 mb-5">
    <div class="card neon-card">
        <div class="neon-header">
            <h4 class="neon-title">Yeni Araç Ekle</h4>
        </div>

        <div class="card-body">
            <form asp-action="Create" method="post" enctype="multipart/form-data" novalidate>
                @Html.AntiForgeryToken()

                <div class="row g-4">

                    <!-- Resim -->
                    <div class="col-md-6">
                        <label class="form-label">Resim</label>

                        <label class="neon-upload" id="imageLabel">
                            <span id="imageLabelText">Resim Seç</span>
                            <img id="imageInLabel" class="img-fluid rounded d-none" style="max-height:120px; margin-top:8px;" />
                            <input type="file"
                                   name="imageFile"
                                   accept="image/*"
                                   onchange="previewNewImageInLabel(event)" />
                        </label>
                    </div>


                    <div class="col-md-6"></div>

                    <!-- Temel Bilgiler -->
                    <div class="col-md-6">
                        <label class="form-label">Model</label>
                        <input asp-for="Model" class="form-control" />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label">Yıl</label>
                        <input asp-for="Year" class="form-control" />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label">Fiyat</label>
                        <input asp-for="Price" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Kilometre</label>
                        <input asp-for="Mileage" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Motor Gücü</label>
                        <input asp-for="EnginePower" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Motor Hacmi</label>
                        <input asp-for="EngineCapacity" class="form-control" />
                    </div>

                    <!-- Seçimler -->
                    <div class="col-md-6">
                        <label class="form-label">Marka</label>
                        <select asp-for="BrandId" asp-items="ViewBag.Brands" class="form-select"></select>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Yakıt</label>
                        <select asp-for="FuelType" asp-items="ViewBag.FuelTypes" class="form-select"></select>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Vites</label>
                        <select asp-for="GearType" asp-items="ViewBag.GearTypes" class="form-select"></select>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Durum</label>
                        <select asp-for="isAvailable" class="form-select">
                            <option value="true">Müsait</option>
                            <option value="false">Değil</option>
                        </select>
                    </div>

                    <!-- RENK -->
                    <div class="col-md-6">
                        <label class="form-label">Renk</label>

                        <div class="d-flex align-items-center gap-3 mt-2">
                            <!-- Seçili Renk Göstergesi -->
                            <div id="selectedColorLabel" class="selected-color-label">
                                Renk Seçilmedi
                            </div>

                            <!-- Renkler -->
                            <div class="color-badges" id="colorBadges">
                                <span class="color-badge" data-color="Siyah" style="--c:#000000"></span>
                                <span class="color-badge" data-color="Beyaz" style="--c:#ffffff"></span>
                                <span class="color-badge" data-color="Gri" style="--c:#6b7280"></span>
                                <span class="color-badge" data-color="Gümüş" style="--c:#cbd5e1"></span>
                                <span class="color-badge" data-color="Kırmızı" style="--c:#dc2626"></span>
                                <span class="color-badge" data-color="Bordo" style="--c:#7f1d1d"></span>
                                <span class="color-badge" data-color="Mavi" style="--c:#2563eb"></span>
                                <span class="color-badge" data-color="Lacivert" style="--c:#1e3a8a"></span>
                                <span class="color-badge" data-color="Turkuaz" style="--c:#06b6d4"></span>
                                <span class="color-badge" data-color="Yeşil" style="--c:#16a34a"></span>
                                <span class="color-badge" data-color="Zeytin Yeşili" style="--c:#4d7c0f"></span>
                                <span class="color-badge" data-color="Sarı" style="--c:#facc15"></span>
                                <span class="color-badge" data-color="Altın Sarısı" style="--c:#f59e0b"></span>
                                <span class="color-badge" data-color="Turuncu" style="--c:#f97316"></span>
                                <span class="color-badge" data-color="Mor" style="--c:#7c3aed"></span>
                                <span class="color-badge" data-color="Kahverengi" style="--c:#78350f"></span>
                                <span class="color-badge" data-color="Şampanya" style="--c:#e5d3b3"></span>
                                <span class="color-badge" data-color="Bronz" style="--c:#92400e"></span>
                                <span class="color-badge" data-color="Pembe" style="--c:#ec4899"></span>
                            </div>
                        </div>

                        <input asp-for="Color" type="hidden" id="Color" />
                    </div>

                    <!-- Donanım -->
                    <div class="col-md-6">
                        <label class="form-label">Donanım</label>

                        <input type="hidden" name="HasAC" value="false" />
                        <label class="neon-toggle">
                            <input asp-for="HasAC" value="true" />
                            <span class="toggle"></span>
                            <span class="toggle-text">Klima</span>
                        </label>

                        <input type="hidden" name="HasGPS" value="false" />
                        <label class="neon-toggle">
                            <input asp-for="HasGPS" value="true" />
                            <span class="toggle"></span>
                            <span class="toggle-text">GPS</span>
                        </label>
                    </div>

                </div>

                <div class="d-flex justify-content-between mt-4">
                    <a asp-action="Index" class="back-btn">
                        Geri Dön
                    </a>

                    <button type="submit" class="neon-btn">
                        Kaydet
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>
<script src="~/js/site.js"></script>
<script>
    /* === RESİM ÖNİZLEME (EDIT) === */
    function previewNewImage(e) {
        const box = document.getElementById("newPreviewBox");
        const img = document.getElementById("newPreviewImg");

        if (box && img) {
            box.classList.remove("d-none");
            img.src = URL.createObjectURL(e.target.files[0]);
        }
    }

    /* === RENK SEÇİM === */
    const badges = document.querySelectorAll(".color-badge");
    const input = document.getElementById("Color");
    const label = document.getElementById("selectedColorLabel");

    badges.forEach(badge => {

        // EDIT SAYFASI → mevcut renk otomatik seçili gelsin
        if (input && badge.dataset.color === input.value) {
            selectColor(badge);
        }

        badge.addEventListener("click", () => {
            selectColor(badge);
        });
    });

    function selectColor(badge) {
        badges.forEach(b => b.classList.remove("selected"));
        badge.classList.add("selected");

        if (label) {
            const bg = badge.style.getPropertyValue("--c");
            label.textContent = badge.dataset.color;
            label.style.backgroundColor = bg;
            label.style.color = bg === "#ffffff" ? "#000" : "#fff";
        }

        if (input) {
            input.value = badge.dataset.color;
        }
    }
    /*document.getElementById("carForm").addEventListener("submit", function (e) {
        const inputs = [
            document.querySelector('[name="Model"]'),
            document.querySelector('[name="Price"]'),
            document.querySelector('[name="Mileage"]'),
            document.getElementById("Color")
        ];

        const messages = [
            "Model alanı boş bırakılamaz",
            "Fiyat alanı boş bırakılamaz",
            "Kilometre alanı boş bırakılamaz",
            "Renk alanı boş bırakılamaz"
        ];

        for (let i = 0; i < inputs.length; i++) {
            if (!inputs[i].value.trim()) {
                e.preventDefault();
                showToast(messages[i], "error");
                inputs[i].focus();
                return;
            }
        }
    });*/


        function previewNewImageInLabel(e) {
        const labelText = document.getElementById("imageLabelText");
        const imgInLabel = document.getElementById("imageInLabel");

        if (e.target.files && e.target.files[0]) {
            const file = e.target.files[0];
            imgInLabel.src = URL.createObjectURL(file);
            imgInLabel.classList.remove("d-none");

            // İsteğe bağlı: yazıyı gizleyebilirsin
            labelText.style.display = "none";
        }
    }

</script>